<!-- 
	Main page of site.
	This page will contain Left side bar list of registered user.
	Also contain main content to allow post and reply on post.
 -->
<script type="text-javascript" src="/post/assets/js/ng-file-upload.min.js"></script>
<script type="text-javascript" src="/post/assets/js/ng-file-upload-shim.min.js"></script>
<section id="content">
  	<div class="col-lg-3 col-md-3 col-sm-4 col-xs-12">
    	<div class="left-side">
        	<div class="user-panel">
	        	<ul>
                	<li><a href=""><span> <img src="post/assets/profile_pics/img-01.jpg" alt="Mean Book user" /> </span>  <u> More or less random </u></a> </li>
                    <li><a href=""><span> <img src="post/assets/profile_pics/img-02.jpg" alt="Mean Book user" /> </span>  <u> Different typefaces </u></a> </li>
                    <li><a href=""><span> <img src="post/assets/profile_pics/img-03.jpg" alt="Mean Book user" /> </span>  <u> Publication is not </u></a> </li>
                    <li><a href=""><span> <img src="post/assets/profile_pics/img-04.jpg" alt="Mean Book user" /> </span>  <u> Layout impression </u></a> </li>
                    <li><a href=""><span> <img src="post/assets/profile_pics/img-05.jpg" alt="Mean Book user" /> </span>  <u> Realistic so </u></a> </li>
                    <li><a href=""><span> <img src="post/assets/profile_pics/img-06.jpg" alt="Mean Book user" /> </span>  <u> Dummy text is </u></a> </li>
                    <li><a href=""><span> <img src="post/assets/profile_pics/img-07.jpg" alt="Mean Book user" /> </span>  <u> Advantageous when the </u></a> </li>
                    <li><a href=""><span> <img src="post/assets/profile_pics/img-08.jpg" alt="Mean Book user" /> </span>  <u> Overall visual </u></a> </li>
                    <li><a href=""><span> <img src="post/assets/profile_pics/img-09.jpg" alt="Mean Book user" /> </span>  <u> Impression and </u></a> </li>
                    <li><a href=""><span> <img src="post/assets/profile_pics/img-010.jpg" alt="Mean Book user" /> </span>  <u> More or less random </u></a> </li>
	            </ul>
            </div>
        </div>
     </div>
     
     <div class="col-lg-9 col-md-9 col-sm-8 col-xs-12 div_post">
     	<div class="spacing" data-ng-controller="PostController">
			<div class="news-feed">

				<form name="postForm" class="form-horizontal" role="form" ng-submit="add(postForm.$valid,post_data.post_pid)" novalidate>
					<div ng-class="{ 'has-error' : submitted && postForm.content.$invalid }">
						<label mean-token="'create-content'">News Feed</label>
						<textarea placeholder="Comment Here..." name="txt_content" id="txt_content" data-ng-model="post_data.content" ng required>{{post_data.content}}
						</textarea>
						<div ng-show="submitted && postForm.content.$invalid" class="help-block">
							<p ng-show="postForm.content.$error.required">Please add content to post.</p>
						</div>
					</div>
					<div class="post-bottom" ng-controller="HeaderController as hdrctr">
						<div class="img-upload">
							<!-- <a href=""> <i class="fa fa-camera"></i> </a> -->
							<input type="file" ng-model="post.content" name="post_media" ngf-pattern="'image/*,!.ico'" ngf-keep="false" ngf-allow-dir="false" accept="image/*" ngf-max-size="10MB" ng-select="upload($file)">
						</div>
						<button ng-if="hdrctr.hdrvars.authenticated" mean-token="'create-submit'" type="submit">
							<span>Post</span>
						</button>
						<button ng-if="! hdrctr.hdrvars.authenticated" class="login_msg" type="submit">
							<span>Post</span>
						</button>
					</div>
				</form>
			</div>
			
			<div class="comment-part">
				<ul class="comment-list">
					<li data-ng-repeat="post in posts">
						<div class="comment-list-left">
							<span> <img src="post/assets/profile_pics/img-01.jpg" alt="Mean Book user" /></span>
						</div>
						<div class="comment-list-right">
							<div class="comment-here">
								<p id="post_content_{{post._id}}">{{post.content}}</p>
								<div class="comment-bottom">	
									<div ng-controller="HeaderController as hdrctr">
										<span ng-if="hdrctr.hdrvars.authenticated"><i class="fa fa-thumbs-o-up"></i> Like </span>
										<span ng-if="hdrctr.hdrvars.authenticated" class="reply_span"><i class="fa fa-reply"></i> Reply</span>	
										<a ng-if="hdrctr.hdrvars.authenticated && hdrctr.hdrvars.user._id == post.user" ng-click="getPostDetail(post._id)">
											<span class="edit_post" id="edit_post_{{post._id}}" ng-if="hdrctr.hdrvars.authenticated && hdrctr.hdrvars.user._id == post.user"><i class="fa fa-pencil-square-o"></i> Edit </span>
										</a>
										<a ng-if="hdrctr.hdrvars.authenticated && hdrctr.hdrvars.user._id == post.user" ng-click="deletePost(post._id)">
											<span ng-if="hdrctr.hdrvars.authenticated && hdrctr.hdrvars.user._id == post.user"><i class="fa fa-trash-o"></i> Delete </span>
										</a>
										<span class="view_all_reply" id="view_{{post._id}}" ng-if="post.total_reply > 0" total_reply="{{post.total_reply}}">View {{post.total_reply}} Reply</span>
									</div>
									<div class="reply-again">
										<form name="replyForm" ng-submit="addReply(reply, post._id,0)">
											<input type="text" class="txt_reply" name="reply_{{post._id}}" id="reply_{{post._id}}" placeholder="Reply here..." ng-model="reply_data.content" required/>											
											<button type="submit" id="btn_reply_{{post._id}}">POST</button>
											<!-- <a href=""><i class="fa fa-camera"></i></a> -->
										</form>
									</div>
								</div>
							</div>
							<div class="comment-reply comment-reply-div-{{post._id}}" data-ng-repeat="comment_reply in post.reply">
								<div class="comment-list-left ">
									<span> <img src="post/assets/profile_pics/img-02.jpg" alt="Mean Book user" /></span>
								</div>
								<div class="comment-list-right sub-comment-css">
									<div class="comment-here">
										<p>{{comment_reply.content}}</p>
										<div class="comment-bottom">
											<div ng-controller="HeaderController as hdrctr">
												<span ng-if="hdrctr.hdrvars.authenticated"><a href=""> <i class="fa fa-thumbs-o-up"></i> Like </a></span>
												<span ng-if="hdrctr.hdrvars.authenticated" class="reply_span"> <i class="fa fa-reply"></i> Reply </span>
												<a ng-click="getPostDetail(post._id)">
													<span class="edit_post" id="edit_post_{{post._id}}" ng-if="hdrctr.hdrvars.authenticated && hdrctr.hdrvars.user._id == post.user"><i class="fa fa-pencil-square-o"></i> Edit </span>
												</a>
												<a ng-if="hdrctr.hdrvars.authenticated && hdrctr.hdrvars.user._id == comment_reply.user" ng-click="deleteReply(comment_reply._id)">
													<span ng-if="hdrctr.hdrvars.authenticated && hdrctr.hdrvars.user._id == post.user"><i class="fa fa-trash-o"></i> Delete </span>
												</a>
												<span class="view_all_sub_reply" id="view_sub_reply_{{comment_reply._id}}">View Reply</span>
											</div>
											<div class="reply-again" id="reply-again_{{comment_reply._id}}">
												<form name="replyForm" ng-submit="addReply(reply, post._id,comment_reply._id)">
													<input type="text" class="txt_reply" name="reply_{{post._id}}" id="reply_{{post._id}}" placeholder="Reply here..." ng-model="reply_data.content" required/>
													<button type="submit" id="btn_reply_{{post._id}}">POST</button>
													<!-- <a href=""><i class="fa fa-camera"></i></a> -->
												</form>
											</div>
										</div>
									</div>
									
									<div class="sub-comment-reply sub-comment-div-{{sub_comment_reply.parent_comment_id}}" data-ng-repeat="sub_comment_reply in comment_reply.sub_reply">
										<div class="comment-list-left">
											<span> <img src="post/assets/profile_pics/img-02.jpg" alt="Mean Book user" /></span>
										</div>
										<div class="comment-here">
											<p>{{sub_comment_reply.content}}</p>
											<div class="comment-bottom">
												<div ng-controller="HeaderController as hdrctr">
													<span ng-if="hdrctr.hdrvars.authenticated"><i class="fa fa-thumbs-o-up"></i> Like </span>
													<span ng-if="hdrctr.hdrvars.authenticated" id="sub-reply-link_{{sub_comment_reply.parent_comment_id}}" class="sub-reply-link"><i class="fa fa-reply"></i> Reply </span>
													<a ng-click="getPostDetail(post._id)">
														<span class="edit_post" id="edit_post_{{post._id}}" ng-if="hdrctr.hdrvars.authenticated && hdrctr.hdrvars.user._id == post.user"><i class="fa fa-pencil-square-o"></i> Edit </span>
													</a>
													<a ng-if="hdrctr.hdrvars.authenticated && hdrctr.hdrvars.user._id == sub_comment_reply.user" ng-click="deleteReply(sub_comment_reply._id)">
														<span ng-if="hdrctr.hdrvars.authenticated && hdrctr.hdrvars.user._id == post.user"><i class="fa fa-trash-o"></i> Delete </span>
													</a>
												</div>
											</div>
										</div>
									</div>
								</div>	
							</div>
						</div>
					</li>
				</ul>
			</div>
        </div>
	</div>
</section>
<div class="modal" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
	<div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel"> Login </h4>
            </div>
            <div class="modal-body">
				<div class="main-form" ng-controller="AuthCtrl" ng-class="($state.is('auth.register')) ? 'register-form' : ''">
					<div class="login-form__left" ui-view="">
						<div data-ng-controller="LoginCtrl as login">

							<div class="alert alert-danger animated fadeIn" ng-show="login.loginError">{{login.loginError}}</div>

							<!-- <h2>Login</h2> -->

							<form id="login_form" ng-submit="login.login()">
								<div class="input-wrapper">
									<input required id="email_block" type="email" name="email" placeholder="Email Address" ng-model="login.user.email">
									<div class="error_message">Please enter a correct info #</div>
									<span class="pic email"></span>
								</div>
								<div class="input-wrapper">
									<input required id="password_block" name="password" type="{{login.input.type}}" placeholder="{{login.input.placeholder}}" ng-model="login.user.password">
									<div class="error_message">Please enter a correct info #</div>
										<span class="pic password {{login.input.iconClass}}" ng-click = "login.togglePasswordVisible()">
											  <div class="hide_text_password">
												  {{login.input.tooltipText}}
											  </div>
										</span>
								</div>
								<div class="forgot_password">
									<a ui-sref='forgot-password'>Forgot your password?</a>
								</div>
								<div class="button_login">
									<button type="submit" class="submit_button">Login</button>
									<p>Don't have an account?</p>
									<a href="javascript:void(0)" class="register_link">Sign up</a>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
            <!-- <div class="modal-footer">
                <button type="button" class="btn btn-secure redeemPromo" data-dismiss="modal">Continue</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            </div> -->
        </div>
    </div>
</div>
<div class="modal" id="registerModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
	<div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Sign Up</h4>
            </div>
            <div class="modal-body">
				<div class="main-form" ng-controller="AuthCtrl" ng-class="($state.is('auth.register')) ? 'register-form' : ''">
					<div class="login-form__left" ui-view="">
						<div data-ng-controller="RegisterCtrl as reg">
							<div ng-repeat="error in reg.registerError">
								<div class="alert alert-danger animated fadeIn">{{error.msg}}</div>
							</div>
							<div class="alert alert-danger animated fadeIn" ng-show="reg.usernameError">{{reg.usernameError}}</div>
							<div class="alert alert-danger animated fadeIn" ng-show="reg.emailError">{{reg.emailError}}</div>
							<form id="register_form" ng-submit="reg.register()">
								<!-- <h2>Sign Up</h2> -->

								<div class="input-wrapper">
									<input required id="name" type="text" name="name" placeholder="Full Name"
										   ng-model="reg.user.name">

									<div class="error_message">Please enter a correct info #</div>
									<span class="pic user"></span>
								</div>

								<div class="input-wrapper">
									<input required id="email_block" type="email" name="email" placeholder="Email Address"
										   ng-model="reg.user.email">

									<div class="error_message">Please enter a correct info #</div>
									<span class="pic email"></span>
								</div>

								<div class="input-wrapper">
									<input required id="username" type="text" name="username" placeholder="Username"
										   ng-model="reg.user.username">

									<div class="error_message">Please enter a correct info #</div>
									<span class="pic username"></span>
								</div>

								<div class="input-wrapper">
									<input required id="password_block" name="password" type="{{reg.input.type}}"
										   placeholder="{{reg.input.placeholder}}" ng-model="reg.user.password">

									<div class="error_message">Please enter a correct info #</div>
								<span class="pic password {{reg.input.iconClass}}" ng-click="reg.togglePasswordVisible()">
									  <div class="hide_text_password">
										  {{reg.input.tooltipText}}
									  </div>
								</span>
								</div>
								<div class="input-wrapper">
									<input required id="confirm_password" name="confirm_password" type="{{reg.input.type}}"
										   placeholder="{{reg.input.placeholderConfirmPass}}" ng-model="reg.user.confirmPassword">

									<div class="error_message">Please enter a correct info #</div>
								<span class="pic password {{reg.input.iconClassConfirmPass}}" ng-click="reg.togglePasswordConfirmVisible()">
									  <div class="hide_text_password">
										  {{reg.input.tooltipTextConfirmPass}}
									  </div>
								</span>
								</div>

								<div class="button_register">
									<button type="submit" class="submit_button">Sign up</button>
									<p>Already have an account?</p>
									<a href="javascript:void(0)" class="login_link">Log in</a>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="modal" id="loginMsgModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
	<div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">&nbsp;</h4>
            </div>
            <div class="modal-body">
				<div>
					<p class="lead">Please login or register to post something to the newsfeed.</p>
					<p class="lead"><a class="login_link"><u>Click Here</u></a> to Login.</p>
				</div>
			</div>
			<div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
	$(document).ready(function(){
		$(document).on('click', '.reply_span', function(){
			$('.reply-again').css('display', 'none');
			$(this).parent().next().css('display', 'inline-block');
		});
		$(document).on('click', '.sub-reply-link', function(){
			$('.reply-again').css('display', 'none');
			var link_id = $(this).attr('id');
			link_id = link_id.replace('sub-reply-link_','')
			$('#reply-again_' + link_id).css('display', 'inline-block');
		});
		$(document).on('click', '.login_msg', function(){
			$('.modal').modal('hide');
			$('#loginMsgModal').modal('show');
		});
		$(document).on('click', '.login_link', function(){
			$('.modal').modal('hide');
			$('#loginModal').modal('show');
		});
		$(document).on('click', '.register_link', function(){
			$('.modal').modal('hide');			
			$('#registerModal').modal('show');
		});
		$(document).on('hidden.bs.modal', '#registerModal, #loginModal', function (e) {
			console.log('modal close');
			$(this).find('.modal-body .alert').css('display','none')
		});
		$(document).on('click', '.view_all_reply', function (e) {
			var id= $(this).attr('id');
			var total_reply = $(this).attr('total_reply');
			id = id.replace('view_','');
			if( $(this).text() == 'View ' + total_reply + ' Reply'){
				$(this).text('Hide Reply');
			} else {
				$(this).text('View ' + total_reply + ' Reply');
			}
			if( $('.comment-reply-div-' + id).css('display') == "inline-block" ){
				$('.comment-reply-div-' + id).css('display','none');
			}
			else{
				$('.comment-reply-div-' + id).css('display','inline-block');
			}
		});
		$(document).on('click', '.view_all_sub_reply', function (e) {
			var id = $(this).attr('id');
			id = id.replace('view_sub_reply_','');
			if( $(this).text() == 'View ' + total_reply + ' Reply'){
				$(this).text('Hide Reply');
			} else {
				$(this).text('View ' + total_reply + ' Reply');
			}
			if( $('.sub-comment-div-' + id).css('display') == "inline-block" ){
				$('.sub-comment-div-' + id).css('display','none');
			}else{
				$('.sub-comment-div-' + id).css('display','inline-block');
			}
		});
	});
</script>